# 给策划的配表工具功能介绍

## 新建或修改配表结构的流程

1. 新建或修改csv或excel文件，csv文件前2行或3行做为header，

   1. 第一行是中文描述，第二行是程序用名
   2. 选择2行还是3行，随项目定，定了后整个项目所有文件都遵照这个约定随意。如果选择用3行，则第三行随意，我们可以约定填类型，但真正的类型以xml里为准
   
2. 然后交给程序就ok了

	* 程序使用configgen.jar 来完善xml，如果xml不满足需求，则手动修改xml，比如修改type，主键，增加唯一键，外键，枚举，取值约束等

## 更改配表数据的流程

1. 更改csv或excel里的数据，随便改
2. 然后根据需求双击配表顶层目录下的以下任一文件
   1. 校验数据.bat
   2. 校验数据并生成客户端配置.bat
   3. 校验数据并生成服务器配置.bat
   4. 校验数据并生成客户端和服务器配置.bat
3. 如果出错，根据出错提示修改数据，如果正确，则可以提交svn了

## 目录结构

- 不要在顶层目录放csv或excel文件，而是都要放到子文件夹下，比如equip目录下


- excel文件可以包含多个sheet，生成时excel文件名被忽略，而直接用sheet名称，csv文件则直接用csv的文件名。名称如果不是a-z，A-Z开头的就忽略，策划可以多建sheet或csv来做说明，反正程序是不会读这些的。


- 每个子文件夹会生成相应的xml，equip目录下生成equip.xml，做为excel，csv数据文件的格式描述，在这里程序会配置上bean，table列的类型，主键，唯一键，外键，枚举，取值约束等


## 表行数太多，或想多人同时修改减少冲突怎么办？

比如item表，太多行，那可以分开item.csv，item_1.csv，item_2.csv......如果是excel可以是分成多个sheet，item，item_1，item_2......

逻辑上认为就还是一个item表

## 表列数太多怎么办？

这种一般是表里面有个列表，可能有20个复合结构，虽然大多数是只要1，2个

那这个时候可以分成2个表，把这20个复合结构，配置到另一个表中，配20行，加一列数据表示是原表中主键，这样关系就建立起来了

## 功能支持

支持自定义结构，嵌套结构，以及多态结构，这些结构的定义由程序来在xml中描述

支持表之间的链接关系，在校验数据.bat会自动检验这些，比如完成任务里的KillMonster的第一个参数是monsterid，这个id必须在monster表中存在。这个会校验。

具体的功能请参考其他文档。

## 可空的单元格

比如dialog表，可以配置一个npcid，如果配置了npcid，则朝向他，如果没配的话就不转向

则如果不配置npc，就把npcid对应的单元格留空，不要填0，-1

- excel或csv单元格中不填的话默认为false,0,""，所以不要用0作为一行的id。如果有nullableRef请不要填0，请用留空。否则程序会检测报错.
        

## 复杂结构的单元格

比如代币奖励，有两个字段，一个是代币类型，一个是数量，可以在一个单元格里配置，比如

| reward |
| ------ |
| 1,100  |

甚至可以在一个单元格里配置代币奖励列表

| rewardList     |
| :------------- |
| (1,100),(2,50) |

还支持多态的类型，比如task表，需要配置任务完成条件，可以如下

| Condition                               |
| :-------------------------------------- |
| GatherItem(1001, 1)                     |
| CondAnd(LevelUp(5),KillMonster(101, 3)) |

